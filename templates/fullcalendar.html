<!DOCTYPE html>
<html>
<head>
    <style>
  /* Make calendar event background transparent */
  .fc-event {
      background-color: transparent !important;
      border: none !important;
      padding: 0 !important;
  }

  /* Optional: remove hover background too */
  .fc-event:hover {
      background-color: transparent !important;
  }
</style>
<style>
  .fc-event {
      background-color: transparent !important;
      border: none !important;
      padding: 0 !important;
      white-space: normal !important;      /* Allows wrapping */
      word-wrap: break-word !important;    /* Wrap long words */
      display: block !important;
  }

  .fc-event-title {
      white-space: normal !important;      /* Important for HTML events */
  }

  .fc-daygrid-event {
      line-height: 1.2 !important;
      font-size: 0.85em;
  }
</style>

    <meta charset='utf-8' />
    <title>Delivery Calendar (Monthly View)</title>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Quill Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body style="padding: 30px; font-family: sans-serif;">
    <h1>üóïÔ∏è Delivery Calendar (Monthly View)</h1>
    <div id='calendar'></div>

    <!-- Modal: Edit Entry -->
    <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalLabel">Edit Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" id="editForm">
                    <div class="modal-body">
                        <input type="hidden" name="date" id="editDate">
                        <input type="hidden" name="note" id="hiddenNoteEdit">
                        <div class="mb-2">
                            <label class="form-label">Note</label>
                            <div id="quillNoteEdit" style="height: 150px;"></div>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Details</label>
                            <textarea name="details" id="editDetails" class="form-control"></textarea>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Address</label>
                            <input type="text" name="address" id="editAddress" class="form-control">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Phone</label>
                            <input type="text" name="phone" id="editPhone" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Add Entry -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form method="POST" action="/add_from_calendar">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addModalLabel">Add New Entry</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="date" id="addDate">
                        <input type="hidden" name="note" id="hiddenNote">
                        <div class="mb-3">
                            <label class="form-label">Note</label>
                            <div id="quillNote" style="height: 150px;"></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Details</label>
                            <textarea name="details" class="form-control"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <input type="text" name="address" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="text" name="phone" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Add Entry</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <script>
        var quillAdd, quillEdit;

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 'auto',
                events: '/events',

                eventClick: function (info) {
                    const entry = info.event;
                    document.getElementById('editDate').value = entry.start.toISOString().split('T')[0];
                    document.getElementById('editDetails').value = entry.extendedProps.details;
                    document.getElementById('editAddress').value = entry.extendedProps.address;
                    document.getElementById('editPhone').value = entry.extendedProps.phone;

                    quillEdit.root.innerHTML = entry.extendedProps.description || '';
                    document.getElementById('editForm').action = `/edit_from_calendar/${entry.id}`;

                    const modal = new bootstrap.Modal(document.getElementById('eventModal'));
                    modal.show();
                },

                eventDidMount: function (info) {
                    info.el.innerHTML = info.event.extendedProps.description;
                },

                dateClick: function (info) {
                    document.getElementById('addDate').value = info.dateStr;
                    const modal = new bootstrap.Modal(document.getElementById('addModal'));
                    modal.show();
                }
            });

            calendar.render();

            // Init Quill
            quillAdd = new Quill('#quillNote', {
                theme: 'snow',
                modules: {
                    toolbar: [['bold', 'italic'], [{ 'color': [] }], ['clean']]
                }
            });

            quillEdit = new Quill('#quillNoteEdit', {
                theme: 'snow',
                modules: {
                    toolbar: [['bold', 'italic'], [{ 'color': [] }], ['clean']]
                }
            });

            document.querySelector('#addModal form').addEventListener('submit', function () {
                document.getElementById('hiddenNote').value = quillAdd.root.innerHTML;
            });

            document.querySelector('#eventModal form').addEventListener('submit', function () {
                document.getElementById('hiddenNoteEdit').value = quillEdit.root.innerHTML;
            });
        });
    </script>
</body>
</html>
